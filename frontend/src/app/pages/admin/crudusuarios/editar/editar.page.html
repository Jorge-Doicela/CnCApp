<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/gestionar usuarios"></ion-back-button>
    </ion-buttons>
    <ion-title class="ion-text-center">Editar Usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card class="main-card">
    <ion-card-content>
      <div class="form-header fade-in">
        <h2 class="section-title">Actualizar información de usuario</h2>
        <p class="section-description">Modifique los datos del usuario y guarde los cambios</p>
      </div>

      <!-- Formulario de edición -->
      <div class="form-container fade-in" style="animation-delay: 0.2s;">
        <div class="form-section">
          <h3 class="subsection-title">Información Personal</h3>

          <div class="field-group">
            <ion-item class="form-field">
              <ion-icon name="person-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Nombre Completo</ion-label>
              <ion-input [(ngModel)]="usuario.Nombre_Usuario" required></ion-input>
            </ion-item>

            <ion-item class="form-field">
              <ion-icon name="card-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Cédula</ion-label>
              <ion-input [(ngModel)]="usuario.CI_Usuario" required></ion-input>
            </ion-item>
          </div>

          <div class="field-group">
            <ion-item class="form-field">
              <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Teléfono Celular</ion-label>
              <ion-input type="tel" [(ngModel)]="usuario.Celular_Usuario"></ion-input>
            </ion-item>

            <ion-item class="form-field">
              <ion-icon name="home-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Teléfono Convencional</ion-label>
              <ion-input type="tel" [(ngModel)]="usuario.Convencional_Usuario"></ion-input>
            </ion-item>
          </div>

          <div class="field-group">
            <ion-item class="form-field">
              <ion-icon name="male-female-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Género</ion-label>
              <ion-select [(ngModel)]="usuario.Genero_Usuario" interface="action-sheet">
                <ion-select-option value="Masculino">Masculino</ion-select-option>
                <ion-select-option value="Femenino">Femenino</ion-select-option>
                <ion-select-option value="Otro">Otro</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item class="form-field">
              <ion-icon name="people-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Autodefinición Étnica</ion-label>
              <ion-select [(ngModel)]="usuario.Etnia">
                <ion-select-option value="AFROECUATORIANO">Afroecuatoriano</ion-select-option>
                <ion-select-option value="BLANCO">Blanco</ion-select-option>
                <ion-select-option value="INDÍGENA">Indígena</ion-select-option>
                <ion-select-option value="MESTIZO">Mestizo</ion-select-option>
                <ion-select-option value="MONTUBIO">Montubio</ion-select-option>
                <ion-select-option value="OTRO">Otro</ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <div class="field-group">
            <ion-item class="form-field">
              <ion-icon name="flag-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Nacionalidad</ion-label>
              <ion-select [(ngModel)]="usuario.Nacionalidad_Usuario">
                <ion-select-option value="Ecuatoriana">Ecuatoriana</ion-select-option>
                <ion-select-option value="Otra">Otra</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item class="form-field">
              <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Fecha de Nacimiento</ion-label>
              <ion-datetime displayFormat="YYYY-MM-DD" [(ngModel)]="usuario.Fecha_Nacimiento_Usuario"></ion-datetime>
            </ion-item>
          </div>

          <ion-item class="form-field">
            <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
            <ion-label position="floating">Código de Cantón</ion-label>
            <ion-input [(ngModel)]="usuario.canton"></ion-input>
          </ion-item>
        </div>

        <div class="form-section">
          <h3 class="subsection-title">Información del Sistema</h3>

          <div class="field-group">
            <ion-item class="form-field">
              <ion-icon name="shield-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Rol</ion-label>
              <ion-select [(ngModel)]="usuario.Rol_Usuario" interface="action-sheet">
                <ion-select-option *ngFor="let rol of roles" [value]="rol.Id_Rol">
                  {{ rol.nombre_rol === 'admin' ? 'Administrador (activo)' :
                  rol.nombre_rol === 'user' ? 'Usuario (activo)' :
                  rol.nombre_rol }}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item class="form-field">
              <ion-icon name="business-outline" slot="start" color="primary"></ion-icon>
              <ion-label position="floating">Entidad</ion-label>
              <ion-select [(ngModel)]="usuario.Entidad_Usuario" interface="action-sheet">
                <ion-select-option *ngFor="let entidad of entidades" [value]="entidad.Id_Entidad">
                  {{ entidad.Nombre_Entidad }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <ion-item class="form-field">
            <ion-icon name="power-outline" slot="start" color="primary"></ion-icon>
            <ion-label position="floating">Estado</ion-label>
            <ion-select [(ngModel)]="usuario.Estado_Usuario" interface="action-sheet">
              <ion-select-option [value]="1">Usuario Habilitado</ion-select-option>
              <ion-select-option [value]="0">Usuario no Habilitado</ion-select-option>
            </ion-select>
          </ion-item>

          <div class="firma-section">
            <h4 class="subsection-title">Firma Digital</h4>

            <div class="firma-container">
              <div class="firma-preview" *ngIf="usuario.Firma_Usuario">
                <img [src]="usuario.Firma_Usuario" alt="Firma actual" class="firma-image">
                <ion-button size="small" color="danger" fill="outline" (click)="eliminarFirma()">
                  <ion-icon slot="start" name="trash-outline"></ion-icon>
                  Eliminar firma
                </ion-button>
              </div>

              <div class="firma-upload">
                <ion-item class="firma-item">
                  <ion-icon name="create-outline" slot="start" color="primary"></ion-icon>
                  <ion-label>Seleccionar nueva firma</ion-label>
                  <input type="file" class="firma-input" (change)="seleccionarFirma($event)" />
                </ion-item>
                <p class="firma-hint">Formatos aceptados: JPG, PNG (máx. 2MB)</p>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <ion-button fill="outline" color="medium" routerLink="/gestionar usuarios">
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            Cancelar
          </ion-button>
          <ion-button color="primary" (click)="actualizarUsuario()">
            <ion-icon name="save-outline" slot="start"></ion-icon>
            Guardar Cambios
          </ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>
