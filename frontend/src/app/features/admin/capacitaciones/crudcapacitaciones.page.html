<!-- crudcapacitaciones.page.html -->
<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Capacitaciones</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Search Section -->
  <div class="search-section fade-in">
    <div class="search-bar">
      <ion-icon name="search-outline"></ion-icon>
      <input type="text" placeholder="Buscar capacitaciones..." [(ngModel)]="terminoBusqueda"
        (input)="aplicarFiltros()">
    </div>

    <!-- Filter Chips -->
    <div class="filter-chips">
      <div class="chip" [class.active]="filtroEstado === 'todos'" (click)="filtroEstado = 'todos'; aplicarFiltros()">
        <ion-icon name="apps-outline"></ion-icon>
        Todas
      </div>
      <div class="chip" [class.active]="filtroEstado === '0'" (click)="filtroEstado = '0'; aplicarFiltros()">
        <ion-icon name="time-outline"></ion-icon>
        Pendientes
      </div>
      <div class="chip" [class.active]="filtroEstado === '1'" (click)="filtroEstado = '1'; aplicarFiltros()">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        Realizadas
      </div>
      <div class="chip" [class.active]="filtroEstado === '2'" (click)="filtroEstado = '2'; aplicarFiltros()">
        <ion-icon name="close-circle-outline"></ion-icon>
        Canceladas
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-section fade-in" style="animation-delay: 0.1s;">
    <div class="stat-card stat-pending">
      <div class="stat-icon">
        <ion-icon name="calendar-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ obtenerCapacitacionesPendientes() }}</div>
        <div class="stat-label">Pendientes</div>
      </div>
    </div>

    <div class="stat-card stat-completed">
      <div class="stat-icon">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ obtenerCapacitacionesRealizadas() }}</div>
        <div class="stat-label">Realizadas</div>
      </div>
    </div>

    <div class="stat-card stat-certificates">
      <div class="stat-icon">
        <ion-icon name="ribbon-outline"></ion-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ obtenerCertificadosEmitidos() }}</div>
        <div class="stat-label">Certificados</div>
      </div>
    </div>
  </div>

  <!-- Section Header -->
  <div class="section-header fade-in" style="animation-delay: 0.2s;">
    <h2>Capacitaciones</h2>
    <span class="count-badge">{{ capacitacionesFiltradas.length }}</span>
  </div>

  <!-- Empty State -->
  <div *ngIf="capacitacionesFiltradas.length === 0" class="empty-state fade-in" style="animation-delay: 0.3s;">
    <ion-icon name="school-outline"></ion-icon>
    <h3>No hay capacitaciones</h3>
    <p>No se encontraron capacitaciones que coincidan con tu búsqueda.</p>
    <ion-button fill="outline" (click)="limpiarFiltros()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Mostrar todas
    </ion-button>
  </div>

  <!-- Capacitaciones List -->
  <div class="capacitaciones-list" *ngIf="capacitacionesFiltradas.length > 0">
    <div class="capacitacion-card fade-in" *ngFor="let capacitacion of capacitacionesFiltradas; let i = index"
      [style.animation-delay]="(0.3 + i * 0.05) + 's'">
      <!-- Card Header -->
      <div class="card-header">
        <div class="header-content">
          <h3>{{ capacitacion.nombre }}</h3>
          <div class="badges">
            <span class="status-badge" [ngClass]="{
                'status-active': capacitacion.estado === 'Activa',
                'status-completed': capacitacion.estado === 'Finalizada',
                'status-canceled': capacitacion.estado === 'Cancelada'
              }">
              {{ getEstadoTexto(capacitacion.estado) }}
            </span>
            <span class="certificate-badge" *ngIf="capacitacion.certificado">
              <ion-icon name="ribbon"></ion-icon>
            </span>
          </div>
        </div>
      </div>

      <!-- Card Body -->
      <div class="card-body">
        <p class="description">{{ capacitacion.descripcion }}</p>

        <div class="details-grid">
          <div class="detail-item">
            <ion-icon name="location"></ion-icon>
            <span>{{ capacitacion.lugar }}</span>
          </div>
          <div class="detail-item">
            <ion-icon name="calendar"></ion-icon>
            <span>{{ capacitacion.fechaInicio | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="detail-item">
            <ion-icon name="laptop-outline"></ion-icon>
            <span>{{ capacitacion.modalidad }}</span>
          </div>
          <div class="detail-item">
            <ion-icon name="time"></ion-icon>
            <span>{{ capacitacion.horas }}h</span>
          </div>
          <div class="detail-item">
            <ion-icon name="people"></ion-icon>
            <span>{{ capacitacion.limiteParticipantes }} max</span>
          </div>
        </div>
      </div>

      <!-- Card Actions -->
      <div class="card-actions">
        <ion-button fill="clear" size="small" (click)="iraVisualizarinscritos(capacitacion.id)">
          <ion-icon name="people-outline" slot="start"></ion-icon>
          Participantes
        </ion-button>
        <ion-button fill="clear" size="small" color="success" (click)="iraEditarCapacitacion(capacitacion.id)">
          <ion-icon name="create-outline" slot="start"></ion-icon>
          Editar
        </ion-button>
        <ion-button fill="clear" size="small" color="danger" (click)="confirmarEliminar(capacitacion.id)">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          Eliminar
        </ion-button>
      </div>

      <!-- Extra Actions -->
      <div class="extra-actions" *ngIf="capacitacion.estado === 'Activa'">
        <ion-button expand="block" color="success" (click)="finalizarCapacitacion(capacitacion.id)">
          <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
          Finalizar Capacitación
        </ion-button>
      </div>

      <div class="extra-actions" *ngIf="capacitacion.estado === 'Finalizada' && !capacitacion.certificado">
        <ion-button expand="block" color="warning" (click)="mostrarConfirmacion(capacitacion.id)">
          <ion-icon name="ribbon-outline" slot="start"></ion-icon>
          Emitir Certificados
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Floating Action Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" (click)="iraCrearCapacitacion()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>