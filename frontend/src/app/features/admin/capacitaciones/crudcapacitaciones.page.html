<ion-content>
  <div class="main-container">

    <!-- Page Header -->
    <div class="admin-header fade-in">
      <div class="header-text">
        <h1>Gesti贸n de Capacitaciones</h1>
        <p>Administra los eventos de formaci贸n y sus participantes</p>
      </div>
      <ion-button class="new-btn" (click)="iraCrearCapacitacion()">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Nueva Capacitaci贸n
      </ion-button>
    </div>

    <!-- Stats Strip -->
    <div class="stats-strip fade-in" style="animation-delay: 0.05s;">
      <div class="stat-box">
        <div class="stat-icon blue">
          <ion-icon name="school-outline"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ Capacitaciones.length }}</span>
          <span class="stat-label">Total</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon green">
          <ion-icon name="calendar-outline"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ obtenerCapacitacionesPendientes() }}</span>
          <span class="stat-label">Activas</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon purple">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ obtenerCapacitacionesRealizadas() }}</span>
          <span class="stat-label">Finalizadas</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon amber">
          <ion-icon name="ribbon-outline"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ obtenerCertificadosEmitidos() }}</span>
          <span class="stat-label">Certificados</span>
        </div>
      </div>
    </div>

    <!-- Actions Bar -->
    <div class="actions-bar fade-in" style="animation-delay: 0.1s;">
      <ion-searchbar [(ngModel)]="terminoBusqueda" (ionInput)="aplicarFiltros()" placeholder="Buscar capacitaciones..."
        class="search-input" [debounce]="200">
      </ion-searchbar>

      <div class="filter-chips">
        <div class="chip" [class.active]="filtroEstado === 'todos'" (click)="filtroEstado = 'todos'; aplicarFiltros()">
          Todas
        </div>
        <div class="chip" [class.active]="filtroEstado === 'Activa'"
          (click)="filtroEstado = 'Activa'; aplicarFiltros()">
          <ion-icon name="time-outline"></ion-icon> Activas
        </div>
        <div class="chip" [class.active]="filtroEstado === 'Finalizada'"
          (click)="filtroEstado = 'Finalizada'; aplicarFiltros()">
          <ion-icon name="checkmark-circle-outline"></ion-icon> Finalizadas
        </div>
        <div class="chip" [class.active]="filtroEstado === 'Cancelada'"
          (click)="filtroEstado = 'Cancelada'; aplicarFiltros()">
          <ion-icon name="close-circle-outline"></ion-icon> Canceladas
        </div>
      </div>
    </div>

    <!-- Section Title -->
    <div class="section-header fade-in" style="animation-delay:0.15s;">
      <h2>Capacitaciones</h2>
      <span class="count-badge">{{ capacitacionesFiltradas.length }}</span>
    </div>

    <!-- Empty State -->
    <div *ngIf="capacitacionesFiltradas.length === 0 && !cargando" class="empty-state fade-in">
      <ion-icon name="school-outline"></ion-icon>
      <h3>No hay capacitaciones</h3>
      <p>No se encontraron capacitaciones con los filtros actuales.</p>
      <ion-button fill="outline" size="small" (click)="limpiarFiltros()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Mostrar todas
      </ion-button>
    </div>

    <!-- Loading -->
    <div *ngIf="cargando" class="loading-state fade-in">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Cargando capacitaciones...</p>
    </div>

    <!-- Cards List -->
    <div class="capacitaciones-list" *ngIf="!cargando">
      <div class="capacitacion-card fade-in" *ngFor="let cap of capacitacionesFiltradas; let i = index"
        [style.animation-delay]="(0.2 + i * 0.04) + 's'">

        <div class="card-top">
          <div class="card-title-row">
            <h3>{{ cap.nombre }}</h3>
            <div class="badges">
              <span class="status-badge" [class.status-active]="cap.estado === 'Activa'"
                [class.status-done]="cap.estado === 'Finalizada'" [class.status-canceled]="cap.estado === 'Cancelada'">
                {{ cap.estado }}
              </span>
              <span class="cert-badge" *ngIf="cap.certificado">
                <ion-icon name="ribbon"></ion-icon>
              </span>
            </div>
          </div>
          <p class="card-desc">{{ cap.descripcion }}</p>
        </div>

        <div class="card-meta">
          <div class="meta-item">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{ cap.lugar }}</span>
          </div>
          <div class="meta-item">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>{{ cap.fechaInicio | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="meta-item">
            <ion-icon name="laptop-outline"></ion-icon>
            <span>{{ cap.modalidad }}</span>
          </div>
          <div class="meta-item">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{ cap.horas }}h</span>
          </div>
          <div class="meta-item">
            <ion-icon name="people-outline"></ion-icon>
            <span>{{ cap.limiteParticipantes }} cupos</span>
          </div>
        </div>

        <div class="card-actions">
          <ion-button fill="clear" size="small" (click)="iraVisualizarinscritos(cap.id)">
            <ion-icon name="people-outline" slot="start"></ion-icon>
            Participantes
          </ion-button>
          <ion-button fill="clear" size="small" color="primary" (click)="iraEditarCapacitacion(cap.id)">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar
          </ion-button>
          <ion-button fill="clear" size="small" color="danger" (click)="confirmarEliminar(cap.id)">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Eliminar
          </ion-button>
        </div>

        <div class="card-extra" *ngIf="cap.estado === 'Activa'">
          <ion-button expand="block" color="success" size="small" (click)="finalizarCapacitacion(cap.id)">
            <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
            Finalizar Capacitaci贸n
          </ion-button>
        </div>

        <div class="card-extra" *ngIf="cap.estado === 'Finalizada' && !cap.certificado">
          <ion-button expand="block" color="warning" size="small" (click)="mostrarConfirmacion(cap.id)">
            <ion-icon name="ribbon-outline" slot="start"></ion-icon>
            Emitir Certificados
          </ion-button>
        </div>

      </div>
    </div>

  </div>
</ion-content>