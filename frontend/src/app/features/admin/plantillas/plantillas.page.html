<ion-header [translucent]="true">
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Gestión de Plantillas</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

    <!-- Loading State -->
    <div *ngIf="cargando" class="loading-container">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando plantillas...</p>
    </div>

    <!-- Content -->
    <div *ngIf="!cargando">
        <!-- Header Section -->
        <div class="header-section">
            <div class="header-content">
                <h2>Plantillas de Certificados</h2>
                <p>Gestiona los diseños para tus capacitaciones</p>
            </div>

            <!-- Search Bar -->
            <ion-searchbar *ngIf="plantillas.length > 0" [(ngModel)]="terminoBusqueda" (ionInput)="filtrarPlantillas()"
                placeholder="Buscar plantilla..." animated class="search-bar">
            </ion-searchbar>
        </div>

        <!-- Grid Container -->
        <div class="grid-container" *ngIf="plantillasFiltradas.length > 0">
            <ion-card *ngFor="let plantilla of plantillasFiltradas" class="plantilla-card">
                <!-- Active Badge -->
                <div class="active-badge" *ngIf="plantilla.activa">
                    <ion-icon name="checkmark-circle"></ion-icon>
                    <span>Activa</span>
                </div>

                <!-- Image Container -->
                <div class="image-container">
                    <img [src]="plantilla.imagenUrl" [alt]="plantilla.nombre" (error)="onImageError($event)">
                    <div class="image-overlay">
                        <ion-button fill="clear" size="small" (click)="previsualizarPlantilla(plantilla)">
                            <ion-icon name="eye-outline" slot="icon-only"></ion-icon>
                        </ion-button>
                    </div>
                </div>

                <!-- Card Content -->
                <ion-card-header>
                    <ion-card-title>{{ plantilla.nombre }}</ion-card-title>
                </ion-card-header>

                <ion-card-content>
                    <div class="card-info">
                        <div class="info-item">
                            <ion-icon name="layers-outline"></ion-icon>
                            <span>{{ contarCampos(plantilla) }} campos</span>
                        </div>
                        <div class="info-item">
                            <ion-icon name="calendar-outline"></ion-icon>
                            <span>{{ plantilla.createdAt | date:'dd/MM/yyyy' }}</span>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="actions">
                        <ion-button fill="clear" size="small" [color]="plantilla.activa ? 'success' : 'medium'"
                            (click)="toggleActivar(plantilla)">
                            <ion-icon [name]="plantilla.activa ? 'radio-button-on' : 'radio-button-off'"
                                slot="start"></ion-icon>
                            {{ plantilla.activa ? 'Activa' : 'Activar' }}
                        </ion-button>

                        <ion-button fill="clear" size="small" (click)="editarPlantilla(plantilla.id)">
                            <ion-icon name="create-outline" slot="start"></ion-icon>
                            Editar
                        </ion-button>

                        <ion-button fill="clear" size="small" color="danger" (click)="confirmarEliminar(plantilla)"
                            [disabled]="plantilla.activa">
                            <ion-icon name="trash-outline" slot="start"></ion-icon>
                            Eliminar
                        </ion-button>
                    </div>
                </ion-card-content>
            </ion-card>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="plantillas.length === 0 && !cargando">
            <div class="empty-icon">
                <ion-icon name="document-text-outline"></ion-icon>
            </div>
            <h3>No hay plantillas creadas</h3>
            <p>Crea tu primera plantilla de certificado para comenzar</p>
            <ion-button fill="outline" (click)="crearPlantilla()">
                <ion-icon name="add-outline" slot="start"></ion-icon>
                Crear Primera Plantilla
            </ion-button>
        </div>

        <!-- No Results State -->
        <div class="empty-state" *ngIf="plantillas.length > 0 && plantillasFiltradas.length === 0 && !cargando">
            <div class="empty-icon">
                <ion-icon name="search-outline"></ion-icon>
            </div>
            <h3>No se encontraron resultados</h3>
            <p>No hay plantillas que coincidan con "{{ terminoBusqueda }}"</p>
            <ion-button fill="clear" (click)="limpiarBusqueda()">
                Limpiar búsqueda
            </ion-button>
        </div>
    </div>

    <!-- FAB Button -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="!cargando && plantillas.length > 0">
        <ion-fab-button color="primary" (click)="crearPlantilla()">
            <ion-icon name="add-outline"></ion-icon>
        </ion-fab-button>
    </ion-fab>

</ion-content>