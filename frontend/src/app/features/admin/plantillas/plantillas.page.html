<ion-content>
    <div class="main-container">

        <!-- Page Header -->
        <div class="admin-header fade-in">
            <div class="header-text">
                <h1>Gestión de Plantillas</h1>
                <p>Diseña y administra las plantillas de certificados</p>
            </div>
            <ion-button class="new-btn" (click)="crearPlantilla()" *ngIf="!cargando">
                <ion-icon name="add-outline" slot="start"></ion-icon>
                Nueva Plantilla
            </ion-button>
        </div>

        <!-- Stats Strip -->
        <div class="stats-strip fade-in" style="animation-delay: 0.05s;">
            <div class="stat-box">
                <div class="stat-icon blue">
                    <ion-icon name="document-text-outline"></ion-icon>
                </div>
                <div class="stat-info">
                    <span class="stat-value">{{ plantillas.length }}</span>
                    <span class="stat-label">Total</span>
                </div>
            </div>
            <div class="stat-box">
                <div class="stat-icon green">
                    <ion-icon name="checkmark-circle-outline"></ion-icon>
                </div>
                <div class="stat-info">
                    <span class="stat-value">{{ contarActivas() }}</span>
                    <span class="stat-label">Activa</span>
                </div>
            </div>
            <div class="stat-box">
                <div class="stat-icon purple">
                    <ion-icon name="layers-outline"></ion-icon>
                </div>
                <div class="stat-info">
                    <span class="stat-value">{{ plantillasFiltradas.length }}</span>
                    <span class="stat-label">Filtradas</span>
                </div>
            </div>
        </div>

        <!-- Actions Bar -->
        <div class="actions-bar fade-in" style="animation-delay: 0.1s;" *ngIf="plantillas.length > 0">
            <ion-searchbar [(ngModel)]="terminoBusqueda" (ionInput)="filtrarPlantillas()"
                placeholder="Buscar plantilla..." class="search-input" [debounce]="200">
            </ion-searchbar>
        </div>

        <!-- Loading -->
        <div *ngIf="cargando" class="loading-state fade-in">
            <ion-spinner name="crescent" color="primary"></ion-spinner>
            <p>Cargando plantillas...</p>
        </div>

        <!-- Section Header -->
        <div class="section-header fade-in" style="animation-delay: 0.12s;" *ngIf="!cargando && plantillas.length > 0">
            <h2>Plantillas</h2>
            <span class="count-badge">{{ plantillasFiltradas.length }}</span>
        </div>

        <!-- Grid Cards -->
        <div class="plantillas-grid" *ngIf="!cargando && plantillasFiltradas.length > 0">
            <div class="plantilla-card fade-in" *ngFor="let plantilla of plantillasFiltradas; let i = index"
                [style.animation-delay]="(0.15 + i * 0.05) + 's'" [class.active-card]="plantilla.activa">

                <!-- Image Area -->
                <div class="card-image" (click)="previsualizarPlantilla(plantilla)">
                    <img [src]="plantilla.imagenUrl" [alt]="plantilla.nombre" (error)="onImageError($event)">
                    <div class="image-overlay">
                        <ion-icon name="eye-outline"></ion-icon>
                    </div>
                    <span class="active-badge" *ngIf="plantilla.activa">
                        <ion-icon name="checkmark-circle"></ion-icon>
                        Activa
                    </span>
                </div>

                <!-- Card Content -->
                <div class="card-body">
                    <h3>{{ plantilla.nombre }}</h3>

                    <div class="card-meta">
                        <div class="meta-item">
                            <ion-icon name="layers-outline"></ion-icon>
                            <span>{{ contarCampos(plantilla) }} campos</span>
                        </div>
                        <div class="meta-item">
                            <ion-icon name="calendar-outline"></ion-icon>
                            <span>{{ plantilla.createdAt | date:'dd/MM/yyyy' }}</span>
                        </div>
                    </div>

                    <div class="card-actions">
                        <ion-button fill="clear" size="small" [color]="plantilla.activa ? 'success' : 'medium'"
                            (click)="toggleActivar(plantilla)">
                            <ion-icon [name]="plantilla.activa ? 'radio-button-on' : 'radio-button-off'"
                                slot="start"></ion-icon>
                            {{ plantilla.activa ? 'Activa' : 'Activar' }}
                        </ion-button>
                        <ion-button fill="clear" size="small" color="primary" (click)="editarPlantilla(plantilla.id)">
                            <ion-icon name="create-outline" slot="start"></ion-icon>
                            Editar
                        </ion-button>
                        <ion-button fill="clear" size="small" color="danger" (click)="confirmarEliminar(plantilla)"
                            [disabled]="plantilla.activa">
                            <ion-icon name="trash-outline" slot="start"></ion-icon>
                            Eliminar
                        </ion-button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Empty State - No plantillas -->
        <div class="empty-state fade-in" *ngIf="!cargando && plantillas.length === 0">
            <ion-icon name="document-text-outline"></ion-icon>
            <h3>No hay plantillas creadas</h3>
            <p>Crea tu primera plantilla de certificado para comenzar</p>
            <ion-button fill="outline" (click)="crearPlantilla()">
                <ion-icon name="add-outline" slot="start"></ion-icon>
                Crear Primera Plantilla
            </ion-button>
        </div>

        <!-- Empty State - No results -->
        <div class="empty-state fade-in" *ngIf="!cargando && plantillas.length > 0 && plantillasFiltradas.length === 0">
            <ion-icon name="search-outline"></ion-icon>
            <h3>Sin resultados</h3>
            <p>No hay plantillas que coincidan con "{{ terminoBusqueda }}"</p>
            <ion-button fill="clear" size="small" (click)="limpiarBusqueda()">
                Limpiar búsqueda
            </ion-button>
        </div>

    </div>
</ion-content>