<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/gestionar-usuarios"></ion-back-button>
    </ion-buttons>
    <ion-title>Editar Usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="main-container">

    <!-- Header Section -->
    <div class="header-section fade-in">
      <h1>
        Actualizar Usuario
        <span>Modifique la información del usuario en el sistema</span>
      </h1>
    </div>

    <!-- Form Card -->
    <div class="form-card fade-in" style="animation-delay: 0.1s;">

      <!-- Seccion 1: Identificación y Contacto -->
      <div class="form-section">
        <h3 class="section-title">
          <ion-icon name="person-outline"></ion-icon>
          Información Personal
        </h3>

        <div class="field-group">
          <ion-item class="form-field">
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label position="floating">Nombre Completo *</ion-label>
            <ion-input [(ngModel)]="usuario.nombre" required></ion-input>
          </ion-item>

          <ion-item class="form-field">
            <ion-icon name="id-card-outline" slot="start"></ion-icon>
            <ion-label position="floating">Cédula *</ion-label>
            <ion-input [(ngModel)]="usuario.ci" required readonly></ion-input>
          </ion-item>
        </div>

        <div class="field-group triple">
          <ion-item class="form-field">
            <ion-icon name="call-outline" slot="start"></ion-icon>
            <ion-label position="floating">Celular</ion-label>
            <ion-input type="tel" [(ngModel)]="usuario.telefono"></ion-input>
          </ion-item>

          <ion-item class="form-field">
            <ion-icon name="call-outline" slot="start"></ion-icon>
            <ion-label position="floating">Convencional</ion-label>
            <ion-input type="tel" [(ngModel)]="usuario.convencional"></ion-input>
          </ion-item>

          <ion-item class="form-field">
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            <ion-label>Fecha Nacimiento</ion-label>
            <ion-input type="date" [(ngModel)]="usuario.fechaNacimiento"></ion-input>
          </ion-item>
        </div>

        <div class="field-group">
          <ion-item class="form-field">
            <ion-icon name="male-female-outline" slot="start"></ion-icon>
            <ion-label>Género</ion-label>
            <ion-select [(ngModel)]="usuario.genero" placeholder="Seleccione" interface="popover">
              <ion-select-option value="Masculino">Masculino</ion-select-option>
              <ion-select-option value="Femenino">Femenino</ion-select-option>
              <ion-select-option value="Otro">Otro</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item class="form-field">
            <ion-icon name="people-outline" slot="start"></ion-icon>
            <ion-label>Etnia</ion-label>
            <ion-select [(ngModel)]="usuario.etnia" placeholder="Seleccione" interface="popover">
              <ion-select-option value="AFROECUATORIANO">Afroecuatoriano</ion-select-option>
              <ion-select-option value="BLANCO">Blanco</ion-select-option>
              <ion-select-option value="INDÍGENA">Indígena</ion-select-option>
              <ion-select-option value="MESTIZO">Mestizo</ion-select-option>
              <ion-select-option value="MONTUBIO">Montubio</ion-select-option>
              <ion-select-option value="OTRO">Otro</ion-select-option>
            </ion-select>
          </ion-item>
        </div>
      </div>

      <!-- Seccion 2: Roles y Sistema -->
      <div class="form-section">
        <h3 class="section-title">
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          Permisos y Sistema
        </h3>

        <div class="field-group">
          <ion-item class="form-field">
            <ion-icon name="key-outline" slot="start"></ion-icon>
            <ion-label>Rol de Acceso *</ion-label>
            <ion-select [(ngModel)]="usuario.rolId" placeholder="Seleccione Rol" interface="popover">
              <ion-select-option *ngFor="let rol of roles" [value]="rol.id">
                {{ rol.nombre_rol }}
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item class="form-field">
            <ion-icon name="business-outline" slot="start"></ion-icon>
            <ion-label>Entidad Asociada</ion-label>
            <ion-select [(ngModel)]="usuario.entidadId" placeholder="Seleccione Entidad" interface="popover">
              <ion-select-option *ngFor="let entidad of entidades" [value]="entidad.id">
                {{ entidad.Nombre_Entidad }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <ion-item class="form-field">
          <ion-icon name="power-outline" slot="start"></ion-icon>
          <ion-label>Estado de Cuenta</ion-label>
          <ion-select [(ngModel)]="usuario.estado" placeholder="Seleccione Estado" interface="popover">
            <ion-select-option [value]="1">Habilitado</ion-select-option>
            <ion-select-option [value]="0">Deshabilitado (Bloqueado)</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <!-- Seccion 3: Firma (Opcional) -->
      <div class="form-section">
        <h3 class="section-title">
          <ion-icon name="create-outline"></ion-icon>
          Firma Digital
        </h3>

        <div class="firma-container">
          <div class="firma-preview" *ngIf="usuario.firmaUrl">
            <img [src]="usuario.firmaUrl" alt="Firma actual" class="firma-image">
            <ion-button size="small" color="danger" fill="outline" (click)="eliminarFirma()">
              <ion-icon slot="start" name="trash-outline"></ion-icon>
              Eliminar Firma
            </ion-button>
          </div>

          <div class="firma-upload">
            <ion-item class="firma-item" lines="none">
              <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
              <ion-label>Subir nueva firma</ion-label>
              <input type="file" class="firma-input" (change)="seleccionarFirma($event)"
                accept="image/png, image/jpeg" />
            </ion-item>
            <div class="firma-hint">
              Formatos: PNG, JPG (Máx 2MB).<br>Fondo transparente recomendado.
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <ion-button class="cancel-btn" fill="clear" routerLink="/gestionar-usuarios">
          Cancelar
        </ion-button>
        <ion-button color="primary" (click)="actualizarUsuario()">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          Guardar Cambios
        </ion-button>
      </div>

    </div>
  </div>
</ion-content>