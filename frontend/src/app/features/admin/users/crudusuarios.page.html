<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="ion-text-center">Gestión de Usuarios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card class="main-card">
    <ion-card-content>
      <div class="logo-container ion-text-center">
        <img src="../../../../assets/cnc.png" alt="Logo" class="app-logo">
      </div>

      <div class="section-header fade-in">
        <h2 class="section-title">Administración de Usuarios</h2>
        <p class="section-description">Gestione los usuarios del sistema, sus roles y permisos</p>
      </div>

      <div class="action-section fade-in" style="animation-delay: 0.1s;">
        <ion-button expand="block" class="add-button" color="primary" (click)="iraCrearUsuario()">
          <ion-icon name="person-add-outline" slot="start"></ion-icon>
          Crear nuevo usuario
        </ion-button>

        <!-- Buscador de usuarios -->
        <div class="search-container">
          <ion-item class="search-item">
            <ion-icon name="search-outline" slot="start" color="primary"></ion-icon>
            <ion-input placeholder="Buscar usuario por nombre o cédula" [(ngModel)]="searchTerm"></ion-input>
            <ion-button slot="end" fill="clear" (click)="filtrarUsuarios()">
              <ion-icon name="search"></ion-icon>
            </ion-button>
          </ion-item>
        </div>
      </div>

      <div class="users-section fade-in" style="animation-delay: 0.2s;">
        <div class="list-header">
          <h3 class="section-title">Lista de usuarios registrados</h3>
          <span class="user-count" *ngIf="usuarios.length > 0">{{ usuarios.length }} usuarios</span>
        </div>

        <!-- Lista de usuarios -->
        <div class="users-list" *ngIf="usuarios.length > 0">
          <div class="user-card" *ngFor="let usuario of filteredUsuarios || usuarios">
            <div class="user-info">
              <h2 class="user-name">{{ usuario.nombre }}</h2>
              <p><ion-icon name="id-card-outline"></ion-icon> <strong>Cédula:</strong> {{ usuario.ci }}</p>
              <p><ion-icon name="business-outline"></ion-icon> <strong>Entidad:</strong> {{
                usuario.entidad?.nombre || 'No asignada' }}</p>
              <p><ion-icon name="shield-outline"></ion-icon> <strong>Rol:</strong>
                <span
                  [ngClass]="{'admin-role': usuario.rol?.nombre === 'Administrador', 'user-role': usuario.rol?.nombre === 'Usuario'}">
                  {{ usuario.rol?.nombre || 'No asignado' }}
                </span>
              </p>
              <p><ion-icon name="finger-print-outline"></ion-icon> <strong>Firma:</strong>
                <span [ngClass]="{'firma-disponible': usuario.firmaUrl, 'firma-no-disponible': !usuario.firmaUrl}">
                  {{ usuario.firmaUrl ? 'Firma disponible' : 'Dato no asignado' }}
                </span>
              </p>
              <p><ion-icon name="call-outline"></ion-icon> <strong>Teléfono:</strong> {{ usuario.telefono || 'No
                registrado' }}</p>

              <p><ion-icon name="people-outline"></ion-icon> <strong>Tipo de Participante:</strong> {{
                getTipoParticipante(usuario.tipoParticipante) }}</p>

              <!-- Estado logic might need update if field missing, hiding for now or assuming OK -->
              <div class="estado-usuario activo">
                Usuario Activo
              </div>
            </div>

            <div class="user-actions">
              <ion-button fill="clear" color="primary" (click)="iraEditarUsuario(usuario.id)">
                <ion-icon name="create-outline" slot="icon-only"></ion-icon>
              </ion-button>
              <ion-button fill="clear" color="danger" (click)="confirmarEliminar(usuario)">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Mensaje cuando no hay usuarios -->
        <div class="empty-state" *ngIf="usuarios.length === 0">
          <ion-icon name="people-outline"></ion-icon>
          <h3>No hay usuarios registrados</h3>
          <p>Comience creando un nuevo usuario con el botón superior</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>