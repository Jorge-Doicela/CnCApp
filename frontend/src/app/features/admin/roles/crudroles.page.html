<ion-content [fullscreen]="true">
  <!-- Back Nav -->
  <div class="page-back-nav" style="padding: 10px 20px 0 20px;">
    <ion-button fill="clear" color="medium" size="small" routerLink="/gestionar-reportes">
      <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
      Volver al Panel
    </ion-button>
  </div>

  <div class="container section-padding">

    <!-- Header Page -->
    <div class="admin-header animate-fade-up">
      <div class="header-content">
        <h1>Gestión de Roles</h1>
        <p>Administra los perfiles de acceso y permisos del sistema.</p>
      </div>
    </div>

    <!-- Stats Strip -->
    <div class="stats-grid animate-fade-up">
      <div class="stat-card-modern">
        <div class="stat-icon-wrapper blue">
          <ion-icon name="people"></ion-icon>
        </div>
        <div class="stat-info">
          <h3>{{ Roles.length }}</h3>
          <p>Roles Totales</p>
        </div>
      </div>

      <div class="stat-card-modern">
        <div class="stat-icon-wrapper green">
          <ion-icon name="shield-checkmark"></ion-icon>
        </div>
        <div class="stat-info">
          <h3>{{ rolesActivos }}</h3>
          <p>Roles Activos</p>
        </div>
      </div>

      <div class="stat-card-modern">
        <div class="stat-icon-wrapper purple">
          <ion-icon name="apps"></ion-icon>
        </div>
        <div class="stat-info">
          <h3>{{ obtenerTotalModulos() }}</h3>
          <p>Módulos Asignados</p>
        </div>
      </div>
    </div>

    <!-- Actions Bar (Search & Filter) -->
    <div class="actions-bar animate-fade-up" style="animation-delay: 0.1s;">
      <ion-searchbar class="search-box" mode="ios" placeholder="Buscar rol por nombre..." [(ngModel)]="searchTerm"
        (ionInput)="filtrarRoles()">
      </ion-searchbar>

      <ion-select class="filter-select" interface="popover" [(ngModel)]="filtroEstado" (ionChange)="filtrarRoles()"
        toggleIcon="funnel-outline" placeholder="Estado">
        <ion-select-option value="todos">Todos los Estados</ion-select-option>
        <ion-select-option value="true">Activos</ion-select-option>
        <ion-select-option value="false">Inactivos</ion-select-option>
      </ion-select>

      <ion-button class="btn-create" color="primary" (click)="iraCrearRol()">
        <ion-icon name="add" slot="start"></ion-icon>
        Nuevo Rol
      </ion-button>
    </div>

    <!-- Loading State -->
    <div *ngIf="cargando" class="ion-text-center ion-padding top-50">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p style="color: var(--ion-color-medium); margin-top: 10px;">Cargando roles...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!cargando && rolesFiltrados.length === 0" class="ion-text-center ion-padding" style="margin-top: 40px;">
      <ion-icon name="search-outline" style="font-size: 4rem; color: #cbd5e1;"></ion-icon>
      <h3 style="color: #64748b; margin-top: 16px;">No se encontraron resultados</h3>
      <p style="color: #94a3b8;">Intenta ajustar los filtros de búsqueda.</p>
    </div>

    <!-- Roles Grid -->
    <div class="roles-grid animate-fade-up" style="animation-delay: 0.2s;"
      *ngIf="!cargando && rolesFiltrados.length > 0">

      <div class="role-card" *ngFor="let rol of rolesFiltrados" [class.inactive]="!rol.estado">
        <div class="card-header">
          <h3>{{ rol.nombre }}</h3>
          <span class="status-badge" [ngClass]="rol.estado ? 'active' : 'inactive'">
            {{ rol.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </div>

        <div class="card-body">
          <div class="section-label">
            <ion-icon name="apps-outline"></ion-icon> Permisos
          </div>

          <div class="modules-list" *ngIf="rol.modulos && rol.modulos.length > 0">
            <span class="module-chip" *ngFor="let modulo of rol.modulos | slice:0:3">
              {{ modulo }}
            </span>
            <span class="more-chip" *ngIf="rol.modulos.length > 3" (click)="mostrarTodosLosModulos(rol)">
              +{{ rol.modulos.length - 3 }} más
            </span>
          </div>

          <div class="empty-modules" *ngIf="!rol.modulos || rol.modulos.length === 0">
            Sin módulos asignados
          </div>
        </div>

        <div class="card-footer">
          <ion-button fill="clear" size="small" [color]="rol.estado ? 'warning' : 'success'"
            (click)="cambiarEstadoRol(rol)">
            {{ rol.estado ? 'Desactivar' : 'Activar' }}
          </ion-button>
          <ion-button fill="clear" size="small" color="dark" (click)="iraEditarRol(rol.id)">
            Editar
          </ion-button>
          <ion-button fill="clear" size="small" color="danger" (click)="confirmarEliminar(rol)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>

    </div>

  </div>
</ion-content>