<ion-content class="recovery-content">
  <div class="recovery-layout">

    <!-- Left Side: Branding/Image -->
    <div class="branding-side">
      <div class="branding-content">
        <div class="logo-wrapper">
          <img src="assets/cnc.png" alt="CNC Logo" class="brand-logo">
        </div>
        <h1>Recuperar Acceso</h1>
        <p>Te ayudaremos a restablecer tu contraseña de forma segura para que puedas seguir capacitándote.</p>
        <div class="glass-decoration"></div>
      </div>
      <div class="branding-overlay"></div>
    </div>

    <!-- Right Side: Form Side -->
    <div class="form-side">
      <div class="form-wrapper">
        <div class="header-actions">
          <ion-button fill="clear" color="dark" (click)="volver()" class="back-btn">
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            <ion-label>Volver</ion-label>
          </ion-button>
        </div>

        <div class="mobile-logo-container ion-hide-md-up">
          <img src="assets/cnc.png" alt="CNC Logo" class="mobile-logo">
        </div>

        <!-- Passo: EMAIL -->
        <div *ngIf="paso() === 'email'" class="animate__animated animate__fadeIn">
          <div class="header-text">
            <h2>Restablecer</h2>
            <p>Ingresa tu correo para recibir un enlace</p>
          </div>

          <div class="input-group">
            <ion-item lines="none" class="custom-input">
              <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
              <div class="input-inner">
                <ion-label position="stacked">Correo Electrónico</ion-label>
                <ion-input [value]="email()" (ionInput)="updateEmail($event)" type="email"
                  placeholder="ejemplo@correo.com" mode="md"></ion-input>
              </div>
            </ion-item>
          </div>

          <ion-button expand="block" class="submit-btn" (click)="solicitarRecuperacion()"
            [disabled]="enviando() || !email()">
            <ion-label *ngIf="!enviando()">Enviar Enlace</ion-label>
            <ion-spinner *ngIf="enviando()" name="crescent"></ion-spinner>
          </ion-button>

          <div class="info-box">
            <ion-icon name="information-circle-outline" color="primary"></ion-icon>
            <p>Si el correo existe, recibirás instrucciones en pocos minutos.</p>
          </div>

          <div class="divider">
            <span>¿Recordó su contraseña?</span>
          </div>

          <ion-button expand="block" fill="outline" class="login-redirect-btn" routerLink="/login">
            Iniciar Sesión
          </ion-button>
        </div>

        <!-- Passo: RESETEAR -->
        <div *ngIf="paso() === 'resetear'" class="animate__animated animate__fadeIn">
          <div class="header-text">
            <h2>Nueva Contraseña</h2>
            <p>Establece tus nuevas credenciales</p>
          </div>

          <div class="input-group">
            <ion-item lines="none" class="custom-input">
              <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
              <div class="input-inner">
                <ion-label position="stacked">Nueva Contraseña</ion-label>
                <ion-input [value]="nuevaContrasena()" (ionInput)="updateNuevaContrasena($event)" type="password"
                  placeholder="Mínimo 8 caracteres" mode="md"></ion-input>
              </div>
            </ion-item>
          </div>

          <div class="input-group">
            <ion-item lines="none" class="custom-input">
              <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
              <div class="input-inner">
                <ion-label position="stacked">Confirmar Contraseña</ion-label>
                <ion-input [value]="confirmarContrasena()" (ionInput)="updateConfirmarContrasena($event)"
                  type="password" placeholder="Repita la contraseña" mode="md"></ion-input>
              </div>
            </ion-item>
          </div>

          <!-- Password Checklist -->
          <div class="password-checklist" *ngIf="nuevaContrasena()">
            <div class="check-item" [class.valid]="nuevaContrasena().length >= 8">
              <ion-icon [name]="nuevaContrasena().length >= 8 ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              <span>8+ caracteres</span>
            </div>
            <div class="check-item" [class.valid]="hasUpperCase(nuevaContrasena()) && hasDigit(nuevaContrasena())">
              <ion-icon
                [name]="hasUpperCase(nuevaContrasena()) && hasDigit(nuevaContrasena()) ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              <span>Mayúscula y número</span>
            </div>
            <div class="check-item"
              [class.valid]="nuevaContrasena() === confirmarContrasena() && confirmarContrasena() !== ''">
              <ion-icon
                [name]="nuevaContrasena() === confirmarContrasena() && confirmarContrasena() !== '' ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              <span>Coinciden</span>
            </div>
          </div>

          <ion-button expand="block" class="submit-btn" (click)="actualizarContrasena()"
            [disabled]="enviando() || !nuevaContrasena() || !confirmarContrasena()">
            <ion-label *ngIf="!enviando()">Actualizar Contraseña</ion-label>
            <ion-spinner *ngIf="enviando()" name="crescent"></ion-spinner>
          </ion-button>
        </div>

        <!-- Passo: EXITO -->
        <div *ngIf="paso() === 'exito'" class="success-view animate__animated animate__zoomIn">
          <div class="success-hero">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
          </div>
          <h3>¡Contraseña Actualizada!</h3>
          <p>Tu acceso ha sido restaurado exitosamente. Ya puedes ingresar con tus nuevos datos.</p>
          <ion-button expand="block" class="submit-btn" routerLink="/login">
            Ir al Inicio de Sesión
          </ion-button>
        </div>

        <div class="footer-copy">
          <p>&copy; 2026 Consejo Nacional de Competencias</p>
        </div>
      </div>
    </div>
  </div>
</ion-content>