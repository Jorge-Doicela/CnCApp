<ion-header class="ion-no-border">
  <ion-toolbar class="glass-header">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" color="primary"></ion-back-button>
    </ion-buttons>
    <ion-title class="header-title">
      <img src="assets/certificados/cnc.png" alt="Logo CNC" class="header-logo">
      <span>Normativa y Regulación</span>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  <!-- Background Decor -->
  <div class="background-decor-1"></div>
  <div class="background-decor-2"></div>

  <div class="content-wrapper ion-padding">

    <!-- Hero Section -->
    <div class="page-hero animate-fade-up">
      <span class="pill-badge">Marco Legal</span>
      <h1>Normativa Regulatoria</h1>
      <p>Base legal, resoluciones y documentos técnicos que rigen la descentralización en el Ecuador.</p>
    </div>

    <!-- Search Section -->
    <div class="search-wrapper animate-fade-up" style="animation-delay: 0.1s;">
      <div class="modern-card search-card">
        <div class="search-header">
          <ion-icon name="search-outline" color="primary"></ion-icon>
          <h3>Buscar Documentos</h3>
        </div>

        <div class="search-grid">
          <div class="search-input-group">
            <ion-item lines="none" class="custom-input">
              <ion-icon name="search-outline" slot="start" color="medium"></ion-icon>
              <ion-input placeholder="Palabra clave (ej. tránsito, COOTAD)" [(ngModel)]="searchTerm"
                (keyup.enter)="buscarNormativa()"></ion-input>
            </ion-item>
          </div>

          <div class="filters-group">
            <ion-item lines="none" class="custom-select">
              <ion-icon name="filter-outline" slot="start" color="medium"></ion-icon>
              <ion-select [(ngModel)]="filtroTipo" interface="popover" placeholder="Tipo">
                <ion-select-option value="todos">Todos los tipos</ion-select-option>
                <ion-select-option value="constitucion">Constitución</ion-select-option>
                <ion-select-option value="leyes">Leyes</ion-select-option>
                <ion-select-option value="resoluciones">Resoluciones</ion-select-option>
                <ion-select-option value="acuerdos">Acuerdos</ion-select-option>
                <ion-select-option value="guias">Guías</ion-select-option>
                <ion-select-option value="informes">Informes</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item lines="none" class="custom-select">
              <ion-icon name="calendar-outline" slot="start" color="medium"></ion-icon>
              <ion-select [(ngModel)]="filtroAnio" interface="popover" placeholder="Año">
                <ion-select-option value="todos">Todos los años</ion-select-option>
                <ion-select-option value="2023">2023</ion-select-option>
                <ion-select-option value="2022">2022</ion-select-option>
                <ion-select-option value="2021">2021</ion-select-option>
                <ion-select-option value="2020">2020</ion-select-option>
                <ion-select-option value="2019">2019</ion-select-option>
                <ion-select-option value="anteriores">Anteriores</ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <ion-button expand="block" class="search-btn" (click)="buscarNormativa()">
            Buscar
            <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Resultados de Búsqueda -->
    <div *ngIf="mostrandoResultados" id="resultados-busqueda" class="results-section animate-fade-in">
      <div class="section-header">
        <h3>{{ resultadosTitulo }}</h3>
        <p>{{ filteredDocumentos.length }} documentos encontrados</p>
      </div>

      <div class="documents-grid">
        <div class="modern-card document-card" *ngFor="let doc of filteredDocumentos" (click)="verDocumento(doc.id)">
          <div class="doc-icon-wrapper">
            <ion-icon [name]="doc.tipo === 'resoluciones' ? 'document-text-outline' : 'book-outline'"></ion-icon>
          </div>
          <div class="doc-content">
            <span class="doc-year">{{ doc.anio }}</span>
            <h4>{{ doc.nombre }}</h4>
            <p>{{ doc.descripcion }}</p>
            <div class="doc-meta">
              <span class="badge" [class]="doc.tipo">{{ obtenerTipoBadge(doc.tipo) }}</span>
              <span class="action-text">Ver documento <ion-icon name="arrow-forward-outline"></ion-icon></span>
            </div>
          </div>
        </div>
      </div>

      <div class="ion-text-center ion-margin-top">
        <ion-button fill="outline" color="medium" (click)="volverArriba()">
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Limpiar búsqueda
        </ion-button>
      </div>
    </div>

    <!-- Contenido Principal (Visible si no hay búsqueda) -->
    <div *ngIf="!mostrandoResultados" class="main-content-layout animate-fade-up" style="animation-delay: 0.2s;">

      <!-- Marco Normativo -->
      <section class="category-section">
        <div class="section-header">
          <h3>Marco Normativo Fundamental</h3>
          <div class="separator"></div>
        </div>

        <div class="documents-grid">
          <!-- Constitución -->
          <div class="modern-card document-card featured" (click)="verDocumento('constitucion')">
            <div class="doc-icon-wrapper gold">
              <ion-icon name="scale-outline"></ion-icon>
            </div>
            <div class="doc-content">
              <span class="doc-year">2008</span>
              <h4>Constitución de la República</h4>
              <p>Base fundamental para la organización territorial y el sistema de competencias.</p>
              <div class="doc-footer">
                <span class="badge constitucion">Suprema</span>
              </div>
            </div>
          </div>

          <!-- COOTAD -->
          <div class="modern-card document-card featured" (click)="verDocumento('cootad')">
            <div class="doc-icon-wrapper blue">
              <ion-icon name="library-outline"></ion-icon>
            </div>
            <div class="doc-content">
              <span class="doc-year">2010</span>
              <h4>COOTAD</h4>
              <p>Código Orgánico de Organización Territorial, Autonomía y Descentralización.</p>
              <div class="doc-footer">
                <span class="badge ley">Orgánica</span>
              </div>
            </div>
          </div>

          <!-- COPFP -->
          <div class="modern-card document-card featured" (click)="verDocumento('copfp')">
            <div class="doc-icon-wrapper green">
              <ion-icon name="wallet-outline"></ion-icon>
            </div>
            <div class="doc-content">
              <span class="doc-year">2010</span>
              <h4>COPFP</h4>
              <p>Código Orgánico de Planificación y Finanzas Públicas.</p>
              <div class="doc-footer">
                <span class="badge ley">Orgánica</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Resoluciones Recientes -->
      <section class="category-section ion-margin-top">
        <div class="section-header-flex">
          <div>
            <h3>Resoluciones Destacadas</h3>
            <p>Instrumentos para la transferencia de competencias</p>
          </div>
          <ion-button fill="clear" (click)="verTodasResoluciones()">
            Ver todas <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>

        <div class="resolutions-grid">
          <div class="modern-card resolution-item" (click)="verDocumento('resolucion-transito')">
            <div class="res-icon">
              <ion-icon name="car-sport-outline"></ion-icon>
            </div>
            <div class="res-info">
              <h4>Tránsito y Transporte</h4>
              <span class="res-code">Res. 006-CNC-2012</span>
            </div>
            <ion-icon name="chevron-forward-outline" color="medium"></ion-icon>
          </div>

          <div class="modern-card resolution-item" (click)="verDocumento('resolucion-riego')">
            <div class="res-icon">
              <ion-icon name="water-outline"></ion-icon>
            </div>
            <div class="res-info">
              <h4>Riego y Drenaje</h4>
              <span class="res-code">Res. 008-CNC-2011</span>
            </div>
            <ion-icon name="chevron-forward-outline" color="medium"></ion-icon>
          </div>

          <div class="modern-card resolution-item" (click)="verDocumento('resolucion-ambiental')">
            <div class="res-icon">
              <ion-icon name="leaf-outline"></ion-icon>
            </div>
            <div class="res-info">
              <h4>Gestión Ambiental</h4>
              <span class="res-code">Res. 005-CNC-2014</span>
            </div>
            <ion-icon name="chevron-forward-outline" color="medium"></ion-icon>
          </div>

          <div class="modern-card resolution-item" (click)="verDocumento('resolucion-turismo')">
            <div class="res-icon">
              <ion-icon name="airplane-outline"></ion-icon>
            </div>
            <div class="res-info">
              <h4>Turismo</h4>
              <span class="res-code">Res. 001-CNC-2016</span>
            </div>
            <ion-icon name="chevron-forward-outline" color="medium"></ion-icon>
          </div>
        </div>
      </section>

      <!-- Documentos Técnicos & Repositorios -->
      <div class="grid-2-col ion-margin-top">

        <!-- Documentos Técnicos -->
        <section>
          <div class="section-header">
            <h3>Guías Técnicas</h3>
          </div>
          <div class="simple-list">
            <div class="modern-card list-card" (click)="verDocumento('guia-competencias')">
              <ion-icon name="book-outline" slot="start" color="primary"></ion-icon>
              <div class="list-content">
                <h4>Guía Metodológica</h4>
                <p>Para el ejercicio de competencias</p>
              </div>
            </div>
            <div class="modern-card list-card" (click)="verDocumento('manual-costeo')">
              <ion-icon name="calculator-outline" slot="start" color="secondary"></ion-icon>
              <div class="list-content">
                <h4>Manual de Costeo</h4>
                <p>Metodología financiera</p>
              </div>
            </div>
            <div class="modern-card list-card" (click)="verDocumento('modelos-gestion')">
              <ion-icon name="options-outline" slot="start" color="tertiary"></ion-icon>
              <div class="list-content">
                <h4>Modelos de Gestión</h4>
                <p>Tipologías territoriales</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Repositorios -->
        <section>
          <div class="section-header">
            <h3>Repositorios Digitales</h3>
          </div>
          <div class="repos-grid">
            <div class="repo-box" (click)="verRepositorio('resoluciones')">
              <ion-icon name="file-tray-full-outline"></ion-icon>
              <span>Resoluciones</span>
            </div>
            <div class="repo-box" (click)="verRepositorio('informes')">
              <ion-icon name="bar-chart-outline"></ion-icon>
              <span>Informes</span>
            </div>
            <div class="repo-box" (click)="verRepositorio('guias')">
              <ion-icon name="school-outline"></ion-icon>
              <span>Guías</span>
            </div>
            <div class="repo-box" (click)="verRepositorio('leyes')">
              <ion-icon name="library-outline"></ion-icon>
              <span>Leyes</span>
            </div>
          </div>
        </section>

      </div>

    </div>

  </div>
</ion-content>