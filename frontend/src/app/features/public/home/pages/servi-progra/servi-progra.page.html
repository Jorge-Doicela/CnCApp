<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" color="dark"></ion-back-button>
    </ion-buttons>
    <ion-title color="primary" class="ion-text-center fw-bold">Servicios CNC</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <div class="container section-padding">

    <!-- Hero Title -->
    <div class="page-hero animate-fade-up">
      <h1>Nuestros Servicios y Programas</h1>
      <p>Fortaleciendo la gestión descentralizada y el desarrollo territorial del Ecuador.</p>
    </div>

    <!-- Segment Control -->
    <div class="segment-wrapper animate-fade-up">
      <ion-segment [(ngModel)]="selectedSegment" (ionChange)="segmentChanged()" mode="ios">
        <ion-segment-button value="servicios">
          <ion-label>Servicios</ion-label>
        </ion-segment-button>
        <ion-segment-button value="programas">
          <ion-label>Programas</ion-label>
        </ion-segment-button>
        <ion-segment-button value="eventos">
          <ion-label>Eventos</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- TAB: SERVICIOS -->
    <div *ngIf="selectedSegment === 'servicios'" class="animate-fade-in">
      <div class="clean-grid">
        <!-- Card 1 -->
        <div class="clean-card" (click)="verDetalleServicio('asistencia')">
          <div class="icon-box"><ion-icon name="people-outline"></ion-icon></div>
          <h3>Asistencia Técnica</h3>
          <p>Acompañamiento especializado para mejorar la gestión de competencias en su territorio.</p>
          <div class="card-footer">
            Solicitar <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="clean-card" (click)="verDetalleServicio('fortalecimiento')">
          <div class="icon-box"><ion-icon name="fitness-outline"></ion-icon></div>
          <h3>Fortalecimiento</h3>
          <p>Programas integrales para potenciar las capacidades institucionales de su GAD.</p>
          <div class="card-footer">
            Ver detalles <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="clean-card" (click)="verDetalleServicio('monitoreo')">
          <div class="icon-box"><ion-icon name="analytics-outline"></ion-icon></div>
          <h3>Monitoreo y Evaluación</h3>
          <p>Herramientas y métricas para medir el desempeño y cumplimiento de metas.</p>
          <div class="card-footer">
            Consultar <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
          </div>
        </div>

        <!-- Card 4 -->
        <div class="clean-card" (click)="verDetalleServicio('conflictos')">
          <div class="icon-box"><ion-icon name="shield-checkmark-outline"></ion-icon></div>
          <h3>Resolución de Conflictos</h3>
          <p>Mecanismos efectivos para la mediación y solución de controversias territoriales.</p>
          <div class="card-footer">
            Información <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: PROGRAMAS -->
    <div *ngIf="selectedSegment === 'programas'" class="animate-fade-in">

      <!-- Programa Destacado 1 -->
      <div class="program-card-wide" (click)="verDetallePrograma('capacitacion')">
        <div class="card-media">
          <img src="assets/servicios/capacitacion.jpg" alt="Capacitación">
        </div>
        <div class="card-content">
          <h3><ion-icon name="school-outline"></ion-icon> Plan de Capacitación Continua</h3>
          <p class="description">
            Oferta académica diseñada para servidores públicos y autoridades locales.
            Acceda a cursos virtuales, presenciales y mixtos avalados oficialmente.
          </p>
          <div class="meta-tags">
            <div class="tag"><ion-icon name="laptop-outline"></ion-icon> Virtual</div>
            <div class="tag"><ion-icon name="people-outline"></ion-icon> Presencial</div>
            <div class="tag"><ion-icon name="ribbon-outline"></ion-icon> Certificado</div>
          </div>
        </div>
      </div>

      <!-- Programa Destacado 2 -->
      <div class="program-card-wide" (click)="verDetallePrograma('asistencia')">
        <div class="card-media">
          <img src="assets/servicios/asistencia.jpg" alt="Asistencia">
        </div>
        <div class="card-content">
          <h3><ion-icon name="build-outline"></ion-icon> Asistencia Técnica en Territorio</h3>
          <p class="description">
            Despliegue de equipos técnicos especializados para resolver necesidades específicas
            de gestión en su localidad.
          </p>
          <div class="meta-tags">
            <div class="tag"><ion-icon name="map-outline"></ion-icon> En Sitio</div>
            <div class="tag"><ion-icon name="construct-outline"></ion-icon> Personalizado</div>
          </div>
        </div>
      </div>

      <!-- Expandable List -->
      <div *ngIf="showAllPrograms" class="clean-grid" style="margin-top: 30px;">
        <div class="clean-card" *ngFor="let programa of programasAdicionales" (click)="verDetallePrograma(programa.id)">
          <div class="icon-box"><ion-icon [name]="programa.icono"></ion-icon></div>
          <h3>{{programa.titulo}}</h3>
          <p>{{programa.descripcion}}</p>
        </div>
      </div>

      <div class="ion-text-center" style="margin-top: 30px;">
        <ion-button fill="outline" color="primary" shape="round" (click)="toggleShowAllPrograms()">
          {{ showAllPrograms ? 'Ver Menos' : 'Ver Todos los Programas' }}
          <ion-icon [name]="showAllPrograms ? 'chevron-up' : 'chevron-down'" slot="end"></ion-icon>
        </ion-button>
      </div>

    </div>

    <!-- TAB: EVENTOS -->
    <div *ngIf="selectedSegment === 'eventos'" class="animate-fade-in">
      <div class="events-grid">

        <div class="event-row" *ngFor="let evento of filteredEventos" (click)="verDetalleEvento(evento.id)">
          <div class="date-box">
            <span class="month">{{evento.mes}}</span>
            <span class="day">{{evento.dia}}</span>
          </div>
          <div class="event-info">
            <h4>{{evento.titulo}}</h4>
            <div class="meta">
              <span><ion-icon name="time-outline"></ion-icon> {{evento.hora}}</span>
              <span><ion-icon name="location-outline"></ion-icon> {{evento.lugar}}</span>
            </div>
          </div>
          <div class="status-badge" [ngClass]="evento.estado">
            {{ evento.estado === 'programado' ? 'Abierto' : 'Finalizado' }}
          </div>
        </div>

        <div *ngIf="filteredEventos.length === 0" class="ion-text-center ion-padding">
          <p class="text-medium">No se encontraron eventos con estos filtros.</p>
        </div>

      </div>
    </div>

  </div>
  <!-- Detail Modal -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()" [initialBreakpoint]="0.85"
    [breakpoints]="[0, 0.5, 0.85, 1]">
    <ng-template>
      <div class="modal-content" *ngIf="selectedDetail">

        <!-- Modal Header -->
        <div class="modal-header">
          <div class="modal-drag-indicator"></div>
          <div class="header-actions">
            <!-- Optional close button if needed, but swipe down works -->
          </div>
        </div>

        <!-- Scrollable Content -->
        <div class="modal-body">

          <!-- Icon/Hero -->
          <div class="detail-icon-wrapper">
            <ion-icon [name]="selectedDetail.icono || 'information-circle-outline'"></ion-icon>
          </div>

          <!-- Title & Meta -->
          <h2 class="detail-title">{{ selectedDetail.titulo }}</h2>
          <p class="detail-subtitle" *ngIf="detailType === 'servicio'">Servicio Institucional</p>
          <p class="detail-subtitle" *ngIf="detailType === 'programa'">Programa de Fortalecimiento</p>
          <p class="detail-subtitle" *ngIf="detailType === 'evento'">{{ selectedDetail.fecha }} • {{
            selectedDetail.lugar }}</p>

          <div class="detail-divider"></div>

          <!-- Description -->
          <div class="detail-section">
            <h3 class="section-title">Descripción</h3>
            <p class="section-text">{{ selectedDetail.detalle || selectedDetail.descripcion }}</p>
          </div>

          <!-- Dynamic Lists (Beneficios/Requisitos/Agenda) -->
          <div class="detail-section" *ngIf="selectedDetail.beneficios">
            <h3 class="section-title">Beneficios</h3>
            <ul class="detail-list">
              <li *ngFor="let ben of selectedDetail.beneficios">{{ ben }}</li>
            </ul>
          </div>

          <div class="detail-section" *ngIf="selectedDetail.requisitos">
            <h3 class="section-title">Requisitos</h3>
            <ul class="detail-list">
              <li *ngFor="let req of selectedDetail.requisitos">{{ req }}</li>
            </ul>
          </div>

          <div class="detail-section" *ngIf="selectedDetail.agenda">
            <h3 class="section-title">Agenda</h3>
            <ul class="detail-list time-list">
              <li *ngFor="let item of selectedDetail.agenda">{{ item }}</li>
            </ul>
          </div>

        </div>

        <!-- Sticky Footer -->
        <div class="modal-footer">
          <ion-button expand="block" (click)="closeModal()" fill="outline" color="medium" class="action-btn">
            Cerrar
          </ion-button>
          <ion-button expand="block" (click)="solicitarInformacion()" color="primary" class="action-btn">
            {{ detailType === 'evento' ? 'Inscribirse' : 'Solicitar Información' }}
          </ion-button>
        </div>

      </div>
    </ng-template>
  </ion-modal>

</ion-content>