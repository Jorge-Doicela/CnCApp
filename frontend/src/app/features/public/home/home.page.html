<ion-header class="ion-no-border">
  <ion-toolbar class="main-header">
    <div class="header-container">
      <!-- Logo Section -->
      <div class="logo-section">
        <img src="assets/cnc.png" alt="CNC Logo" class="header-logo">
        <div class="header-text" *ngIf="userName()">
          <h1>Consejo Nacional de Competencias</h1>
          <p>República del Ecuador</p>
        </div>
        <!-- Simple Header for Guests -->
        <div class="header-text" *ngIf="!userName()">
          <h1 class="guest-title">CNC App</h1>
        </div>
      </div>

      <div class="header-actions">
        <!-- User Account Widget for Logged Users -->
        <div class="user-account-widget" *ngIf="userName()">
          <div class="account-info" (click)="navegarModulo('Ver Perfil')">
            <div class="avatar-wrapper">
              <ion-icon name="person-circle"></ion-icon>
            </div>
            <div class="text-wrapper">
              <span class="user-name">{{ userName() }}</span>
              <span class="user-role">{{ roleName() }}</span>
            </div>
          </div>
          <div class="widget-divider"></div>
          <button class="logout-button" (click)="cerrarSesion()" title="Cerrar Sesión">
            <ion-icon name="log-out-outline"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-light">

  <!-- ========================================== -->
  <!-- HERO SECTION (LOGGED IN ONLY)            -->
  <!-- ========================================== -->
  <div class="hero-section" *ngIf="userName()">
    <div class="hero-content">
      <div class="hero-text animate__animated animate__fadeInLeft">
        <h2>Bienvenido, {{ userName() }}</h2>
        <p>Panel de gestión y servicios del Consejo Nacional de Competencias.</p>

        <div class="search-box">
          <ion-icon name="search-outline"></ion-icon>
          <input type="text" placeholder="¿Qué estás buscando?">
          <button>Buscar</button>
        </div>
      </div>
      <div class="hero-image animate__animated animate__fadeInRight">
        <ion-icon name="map-outline" class="hero-icon"></ion-icon>
      </div>
    </div>

    <div class="wave-shape">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
        <path fill="#f8f9fa" fill-opacity="1"
          d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
        </path>
      </svg>
    </div>
  </div>

  <!-- ========================================== -->
  <!-- GUEST SPACE (NO HERO)                      -->
  <!-- ========================================== -->
  <div class="guest-spacer" *ngIf="!userName()" style="height: 20px;"></div>


  <!-- ========================================== -->
  <!-- ADMIN DASHBOARD                            -->
  <!-- ========================================== -->
  <ng-container *ngIf="userName() && (roleName() === 'Administrador' || roleName() === 'administrador')">
    <div class="dashboard-section container section-padding pb-0">

      <!-- Admin Stats -->
      <div class="stats-row">
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper blue">
            <ion-icon name="people-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ usuariosCount }}</h3>
            <p>Usuarios</p>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper green">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ conferenciasCount }}</h3>
            <p>Conferencias</p>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper orange">
            <ion-icon name="document-text-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ certificadosCount }}</h3>
            <p>Certificados</p>
          </div>
        </div>
      </div>

      <!-- Admin Modules Grid -->
      <div class="section-header ion-text-center mt-4">
        <h3>Módulos de Gestión</h3>
        <div class="separator"></div>
      </div>

      <div class="services-grid">
        <div class="service-card" *ngFor="let modulo of modulos()" (click)="navegarModulo(modulo)">
          <div class="icon-circle">
            <ion-icon [name]="getIconForModule(modulo)"></ion-icon>
          </div>
          <h4>{{ modulo }}</h4>
          <p>Administración del sistema</p>
          <div class="card-footer">
            <span>Acceder</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>
      </div>

      <!-- Recent Management -->
      <br>
      <div class="content-block">
        <div class="block-header">
          <h3>Gestión Reciente</h3>
          <a class="view-all" (click)="navegarModulo('Gestionar capacitaciones')">Ir al módulo</a>
        </div>
        <div class="list-container">
          <div class="list-item" *ngFor="let capacitacion of capacitacionesDisponibles.slice(0, 5)">
            <div class="item-icon admin">
              <ion-icon name="create-outline"></ion-icon>
            </div>
            <div class="item-details">
              <h4>{{ capacitacion.nombre }}</h4>
              <p>{{ capacitacion.fechaInicio | date:'dd/MM/yyyy' }} • {{ capacitacion.lugar }}</p>
            </div>
            <div class="item-action">
              <ion-button fill="clear" size="small" (click)="editarCapacitacion(capacitacion.id)">
                Editar
              </ion-button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>


  <!-- ========================================== -->
  <!-- USER DASHBOARD (Logged in, Non-Admin)      -->
  <!-- ========================================== -->
  <ng-container *ngIf="userName() && roleName() !== 'Administrador' && roleName()?.toLowerCase() !== 'administrador'">
    <div class="dashboard-section container section-padding pb-0">

      <!-- User Stats -->
      <div class="stats-row">
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper blue">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ ConferenciasInscritas.length }}</h3>
            <p>Mis Inscripciones</p>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper green">
            <ion-icon name="timer-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ proximasConferencias }}</h3>
            <p>Próximas</p>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon-wrapper orange">
            <ion-icon name="ribbon-outline"></ion-icon>
          </div>
          <div class="stat-info">
            <h3>{{ certificadosDisponibles }}</h3>
            <p>Certificados</p>
          </div>
        </div>
      </div>

      <!-- User Quick Access Grid -->
      <div class="section-header ion-text-center mt-4">
        <h3>Mis Herramientas</h3>
        <div class="separator"></div>
      </div>

      <div class="services-grid">
        <!-- My Profile -->
        <div class="service-card" (click)="navegarModulo('Ver Perfil')">
          <div class="icon-circle">
            <ion-icon name="person-outline"></ion-icon>
          </div>
          <h4>Mi Perfil</h4>
          <p>Gestiona tus datos personales.</p>
          <div class="card-footer">
            <span>Ver perfil</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- My Certificates -->
        <div class="service-card" (click)="navegarModulo('Ver certificaciones')">
          <div class="icon-circle">
            <ion-icon name="document-text-outline"></ion-icon>
          </div>
          <h4>Mis Certificados</h4>
          <p>Descarga tus diplomas.</p>
          <div class="card-footer">
            <span>Descargar</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Trainings -->
        <div class="service-card" (click)="navegarModulo('Ver conferencias')">
          <div class="icon-circle">
            <ion-icon name="school-outline"></ion-icon>
          </div>
          <h4>Capacitaciones</h4>
          <p>Inscríbete en nuevos cursos.</p>
          <div class="card-footer">
            <span>Ver cursos</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Services -->
        <div class="service-card" (click)="navegarModulo('servi-progra')">
          <div class="icon-circle">
            <ion-icon name="briefcase-outline"></ion-icon>
          </div>
          <h4>Servicios</h4>
          <p>Catálogo para GADs.</p>
          <div class="card-footer">
            <span>Ver catálogo</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Validate Certificates -->
        <div class="service-card" (click)="navegarModulo('Validar certificados')">
          <div class="icon-circle">
            <ion-icon name="qr-code-outline"></ion-icon>
          </div>
          <h4>Validar Certificados</h4>
          <p>Verifica autenticidad.</p>
          <div class="card-footer">
            <span>Validar</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>
      </div>

      <!-- Available Conferences List -->
      <br>
      <div class="content-block" *ngIf="capacitacionesDisponibles.length > 0">
        <div class="block-header">
          <h3>Conferencias Disponibles</h3>
          <a class="view-all" (click)="navegarModulo('Ver conferencias')">Ver todas</a>
        </div>
        <div class="horizontal-scroll-container">
          <div class="conference-card-mini" *ngFor="let capacitacion of capacitacionesDisponibles">
            <div class="card-status status-{{ capacitacion.estado === 'Activa' ? 'available' : 'closed' }}">
              {{ capacitacion.estado === 'Activa' ? 'Disponible' : 'Cerrada' }}
            </div>
            <h4>{{ capacitacion.nombre }}</h4>
            <div class="card-meta">
              <span><ion-icon name="calendar-outline"></ion-icon> {{ capacitacion.fechaInicio | date:'dd MMM' }}</span>
              <span><ion-icon name="location-outline"></ion-icon> {{ capacitacion.lugar }}</span>
            </div>
            <button class="action-btn" *ngIf="puedeInscribirse(capacitacion)" (click)="inscribirse(capacitacion.id)">
              Inscribirse
            </button>
          </div>
        </div>
      </div>

    </div>
  </ng-container>


  <!-- ========================================== -->
  <!-- PUBLIC / GUEST VIEW (LANDING PAGE)         -->
  <!-- ========================================== -->
  <ng-container *ngIf="!userName()">
    <div class="dashboard-section container section-padding pb-0" style="margin-top: 0;">
      <div class="section-header ion-text-center">
        <h3>Explora Nuestros Servicios</h3>
        <p>Herramientas públicas del CNC.</p>
        <div class="separator"></div>
      </div>

      <div class="services-grid">
        <!-- Card 1: Oferta Académica -->
        <div class="service-card" (click)="navegarModulo('Ver conferencias')">
          <div class="icon-circle">
            <ion-icon name="school-outline"></ion-icon>
          </div>
          <h4>Oferta Académica</h4>
          <p>Cursos disponibles.</p>
          <div class="card-footer">
            <span>Ver cursos</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Card 2: Validar Certificados -->
        <div class="service-card" (click)="navegarModulo('Validar certificados')">
          <div class="icon-circle">
            <ion-icon name="qr-code-outline"></ion-icon>
          </div>
          <h4>Validar Diplomas</h4>
          <p>Verificar autenticidad.</p>
          <div class="card-footer">
            <span>Validar</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Card 3: Servicios GADs -->
        <div class="service-card" (click)="navegarModulo('servi-progra')">
          <div class="icon-circle">
            <ion-icon name="briefcase-outline"></ion-icon>
          </div>
          <h4>Servicios GADs</h4>
          <p>Catálogo técnico.</p>
          <div class="card-footer">
            <span>Explorar</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>

        <!-- Card 4: Login -->
        <div class="service-card login-card" (click)="iraLogin()"
          style="border-bottom-color: var(--ion-color-secondary);">
          <div class="icon-circle" style="background: var(--ion-color-primary); color: white;">
            <ion-icon name="log-in-outline"></ion-icon>
          </div>
          <h4>Iniciar Sesión</h4>
          <p>Accede a tu cuenta.</p>
          <div class="card-footer">
            <span>Ingresar</span>
            <ion-icon name="arrow-forward"></ion-icon>
          </div>
        </div>
      </div>
    </div>
  </ng-container>


  <!-- ========================================== -->
  <!-- INSTITUTIONAL INFO (Available for All)     -->
  <!-- ========================================== -->
  <div class="container section-padding pb-0">
    <div class="section-header ion-text-center">
      <h3>Institucional</h3>
      <div class="separator"></div>
    </div>

    <!-- Horizontal Scroll for Info (App Feel) -->
    <div class="horizontal-scroll-container">

      <!-- Historia -->
      <div class="conference-card-mini" style="flex: 0 0 200px;" (click)="navegarModulo('historia')">
        <div class="card-status status-available">CNC</div>
        <h4>Historia</h4>
        <div class="card-meta">
          <span><ion-icon name="time-outline"></ion-icon> Trayectoria</span>
        </div>
        <button class="action-btn">Ver</button>
      </div>

      <!-- Normativa -->
      <div class="conference-card-mini" style="flex: 0 0 200px;" (click)="navegarModulo('norma-regul')">
        <div class="card-status status-available">Legal</div>
        <h4>Normativa</h4>
        <div class="card-meta">
          <span><ion-icon name="book-outline"></ion-icon> Base Legal</span>
        </div>
        <button class="action-btn">Leer</button>
      </div>

      <!-- Información -->
      <div class="conference-card-mini" style="flex: 0 0 200px;" (click)="navegarModulo('informacion')">
        <div class="card-status status-available">Info</div>
        <h4>Misión y Visión</h4>
        <div class="card-meta">
          <span><ion-icon name="information-circle-outline"></ion-icon> Quiénes somos</span>
        </div>
        <button class="action-btn">Leer</button>
      </div>

      <!-- Dirección -->
      <div class="conference-card-mini" style="flex: 0 0 200px;" (click)="navegarModulo('direccion')">
        <div class="card-status status-available">Ubicación</div>
        <h4>Dirección</h4>
        <div class="card-meta">
          <span><ion-icon name="location-outline"></ion-icon> Mapa</span>
        </div>
        <button class="action-btn">Ir</button>
      </div>

    </div>
  </div>


  <!-- ========================================== -->
  <!-- APP FOOTER                                 -->
  <!-- ========================================== -->
  <div class="app-footer ion-text-center ion-padding"
    style="margin-top: 20px; color: var(--ion-color-medium); font-size: 0.8rem;">
    <p>&copy; 2026 Consejo Nacional de Competencias</p>
    <p>v2.0.0 • Mobile First</p>
  </div>

</ion-content>